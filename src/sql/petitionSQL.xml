<?xml version="1.0" encoding="UTF-8"?>
<!DOCTYPE mapper
  PUBLIC "-//mybatis.org//DTD Mapper 3.0//EN"
  "http://mybatis.org/dtd/mybatis-3-mapper.dtd">
<mapper namespace="petition">

	<select id="MaxnumCount" resultType="int">
		select max(num)from petition
	</select>
	
	<insert id ="insertArticle" parameterType="petitionDTO">
		insert into petition(
		num,title,content,category,startDate,endDate,writer,link,tag) 
		values(petition_seq.nextval, #{title}, #{content}, #{category}, sysdate, sysdate+(interval '1' month), #{writer},#{link},#{tag})
	</insert>

	<insert id ="insertDiscussion" parameterType="petitionDTO">
		insert into discussion(
		num,write,content,reg,tag,subject,link) 
		values(discussion_seq.nextval, #{write}, #{content}, sysdate, #{tag},#{subject}, #{link})
	</insert>
	 
	<select id ="getCategory" resultType="String">
		select categoryName from category
	</select>
	



	
	<select id ="getArticleCount" resultType="int">
		select count(*) from petition
		<if test="keyword != null">
			where title like '%' || #{keyword} || '%' or content like '%' || #{keyword} || '%' or tag like '%' || #{keyword} || '%'
		</if>
	</select>
	
	<select id="getArticleAll" resultType="petitionDTO" parameterType="map">
		select * from (select num, title, content, category, startDate, endDate, writer,
		petition, petitionState, link, indicatorNum, tag, report, open, rownum r 
		from(select * from petition 
		<if test="keyword != null">
			where title like '%' || #{keyword} || '%' or content like '%' || #{keyword} || '%' or tag like '%' || #{keyword} || '%'
		</if>
		<if test="sort == null">
		order by num desc) order by num desc) 
		</if>
		<if test="sort != null">
		order by petition desc) order by petition desc) 
		</if> 
		where r <![CDATA[>=]]> #{startRow} and r <![CDATA[<=]]>#{endRow}
	</select>
	
	<select id ="getArticleState" resultType="petitionDTO" parameterType="map">
				select * from (select num, title, content, category, startDate, endDate, writer,
		petition, petitionState, link, indicatorNum, tag, report, open,rownum r 
		from(select * from petition where petitionState= #{state} order by num desc) order by num desc) 
		where r <![CDATA[>=]]> #{startRow} and r <![CDATA[<=]]>#{endRow}
	</select>
	
	<select id ="getArticleCategory" resultType="petitionDTO" parameterType="map">
				select * from (select num, title, content, category, startDate, endDate, writer,
		petition, petitionState, link, indicatorNum, tag, report, open,rownum r 
		from(select * from petition where category= #{category} order by num desc) order by num desc) 
		where r <![CDATA[>=]]> #{startRow} and r <![CDATA[<=]]>#{endRow}
	</select>

	<select id ="getArticleCountCategory" resultType="int" parameterType="int">
		select count(*) from petition where category= #{category} 
	</select>

	<select id ="getArticleCountState" resultType="int" parameterType="int">
		select count(*) from petition where petitionState = #{state} 
	</select>
	
	<select id="getCategoryList" resultType="CategoryDTO" >
		select*from category 
	</select>



	<!-- 남은부분은 미리써두면 엉킬까봐 안썻어요! -->
	
	<!-- 청원보기+청원댓글 -->
	
	<!-- resultType으로 리턴
		 parameterType DAO에서 가지고 오는 타입 -->
	
	<select id="getArticle" resultType="PetitionDTO" parameterType="int">
		select * from petition where num = #{num}
	</select>
	
	<insert id="insertPetCmt" parameterType="PetCommentDTO">
		insert into petitionComment values (num_seq.nextval,
											#{petitionNum},
											#{writer},
											#{content},
											sysdate)
	</insert>	
		
	<select id="petCmtListAll" resultType="PetCommentDTO" parameterType="int">
		select * from petitionComment where petitionNum = #{petitionNum}
	</select>
	
	<select id="petCmtCount" resultType="int" parameterType="int" >
		select count(*) from petitionComment where petitionNum = #{petitionNum}
	</select>
	
	<select id="petCmtList" resultType="petCommentDTO" parameterType="map">
		<![CDATA[
		select * from (select num,writer,content,reg, petitionNum, rownum r from
        (select * from petitionComment where petitionNum = #{petitionNum} order by num desc) order by num desc) 
        where r >= #{start} and r <= #{end}
        ]]>
	</select>
	
	<select id="getPetitionIndicator" resultType="petitionIndicatorDTO" parameterType="int">
        select * from petitionIndicator where num = #{num}
    </select>
	
</mapper>

