<?xml version="1.0" encoding="UTF-8"?>
<!DOCTYPE mapper
  PUBLIC "-//mybatis.org//DTD Mapper 3.0//EN"
  "http://mybatis.org/dtd/mybatis-3-mapper.dtd">
<mapper namespace="answer">

	<!-- resultType으로 리턴
		 parameterType DAO에서 가지고 오는 타입 -->

	
	<select id ="getArticleCount" resultType="int" parameterType="map">
		select count(*) from answer A 
			INNER JOIN petition B ON A.petitionNum = B.num
		where A.state = #{state} and A.department = #{department} 
		<if test="category != null and category != '' and category != 0">
			AND A.category = #{category}
		</if>
		<if test="keyword != null and keyword != ''">
			AND B.title LIKE '%' || #{keyword} || '%'
		</if>
	</select>	

	<select id="getCategoryList" resultType="CategoryDTO" >
		select * from category 
	</select>

	<select id="getArticleAll" resultType="answerDTO" parameterType="map">
		select * from (select num, petitionNum, state, category, content, answerLink, name, department, answerDate, recommend, 
		opposite, addition, id, rownum r from(select A.* from answer A
			INNER JOIN petition B ON A.petitionNum = B.num
		where A.department = #{department}
		and A.state = #{state}
		<if test="category != null and category != '' and category != 0">
			AND A.category = #{category}
		</if>
		<if test="keyword != null and keyword != ''">
			AND B.title LIKE '%' || #{keyword} || '%'
		</if>
		<if test="sort != null and sort != ''">
			<choose>
				<when test="sort == 1">
				<!-- 최신순 -->
				ORDER BY B.num DESC
				</when>
				<when test="sort == 2">
				<!-- 동의순 -->
				ORDER BY B.petition DESC
				</when>
			</choose>
		</if>
		)
		) where r <![CDATA[>=]]> #{startRow} and r <![CDATA[<=]]>#{endRow}
	</select>
	

	
	<select id="getPetitionInfo" resultType="petitionDTO" parameterType="int">
      select * from petition where num = #{petitionNum} 
    </select>


	<!-- 답변 완료된 청원 게시판     ########### 보배 ################-->
	
	<select id="completedAnswer" resultType="AnswerDTO" parameterType="map">
		select * from (select num, petitionNum, state, category, content, answerLink, name, department, answerDate, recommend, 
		opposite, addition, id, rownum r from(select*from answer where state= #{state} order by num desc)order by num desc)
		where r <![CDATA[>=]]> #{startRow} and r <![CDATA[<=]]>#{endRow}
	</select>
	
	<select id="completedAnswerCount" resultType="AnswerDTO">
		select count(*) from answer where state=#{state}
	</select>
	
	<select id="getInfobyNum" resultType="petitionDTO" parameterType="int">
		select*from petition where num = #{num}
	</select>
	
	
	
</mapper>

