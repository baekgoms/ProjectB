<?xml version="1.0" encoding="UTF-8"?>
<!DOCTYPE mapper
  PUBLIC "-//mybatis.org//DTD Mapper 3.0//EN"
  "http://mybatis.org/dtd/mybatis-3-mapper.dtd">
<mapper namespace="answer">

	<!-- resultType으로 리턴
		 parameterType DAO에서 가지고 오는 타입 -->
	
	<select id ="getArticleCount" resultType="int">
		select count(*) from answer
		<if test="keyword != null">
			where title like '%' || #{keyword} || '%' or content like '%' || #{keyword} || '%' or tag like '%' || #{keyword} || '%'
		</if>
	</select>
	
	<select id="getArticleAll" resultType="answerDTO" parameterType="map">
		select * from (select num, petitionNum, category, content, answerLink, name, department, answerDate, recommend, 
		opposite, addition, id, title rownum r from(select * from answer 
		<if test="keyword != null">
			where title like '%' || #{keyword} || '%' or content like '%' || #{keyword} || '%' or tag like '%' || #{keyword} || '%'
		</if>
		<if test="sort == null">
		order by num desc) order by num desc) 
		</if>
		<if test="sort != null">
		order by answer desc) order by answer desc) 
		</if> 
		where r <![CDATA[>=]]> #{startRow} and r <![CDATA[<=]]>#{endRow}
	</select>
	
	<select id ="getArticleState" resultType="answerDTO" parameterType="map">
		select * from (select num, petitionNum, category, content, answerLink, name, department, answerDate, recommend, 
		opposite, addition, id, title, rownum r 
		from(select * from answer where petitionState= #{state} order by num desc) order by num desc) 
		where r <![CDATA[>=]]> #{startRow} and r <![CDATA[<=]]>#{endRow}
	</select>
	
	<select id ="getArticleCategory" resultType="answerDTO" parameterType="map">
		select * from (select num, petitionNum, category, content, answerLink, name, department, answerDate, recommend, 
		opposite, addition, id, title, rownum r from(select * from answer where category= #{category} order by num desc) order by num desc) 
		where r <![CDATA[>=]]> #{startRow} and r <![CDATA[<=]]>#{endRow}
	</select>

	<select id ="getArticleCountCategory" resultType="int" parameterType="int">
		select count(*) from answer where category= #{category} 
	</select>

	<select id ="getArticleCountState" resultType="int" parameterType="int">
		select count(*) from petition where petitionState = #{state} 
	</select>
	
	<select id="getCategoryList" resultType="CategoryDTO" >
		select * from category 
	</select>
	
</mapper>

